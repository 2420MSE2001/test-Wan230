name: Manual Grading

on: 
  workflow_dispatch:  # 手动触发

jobs:
  autograde:
    runs-on: ubuntu-latest

    
    steps:
    - name: Checkout Code

      uses: actions/checkout@v4

    - name: Set up Python

      uses: actions/setup-python@v4

      with:
        python-version: '3.10'

    # 新增依赖安装步骤 ▼▼▼

    - name: Install Dependencies

      run: |
        if [ -f "requirements.txt" ]; then

          echo "正在安装全局依赖..."
          pip install -r requirements.txt

        else

          echo "::warning::根目录未找到requirements.txt文件"
        fi

    - name: Run All Tests

      run: |
        total_score=0
    
        tested_count=0
    
        for problem in Problem1 Problem2 Problem3 Problem4 Problem5; do
    
          echo "▄▄▄▄▄▄▄ Testing $problem ▄▄▄▄▄▄▄"
          
          if [ -d "$problem" ]; then
    
            cd $problem
    
            # 添加防止test.py不存在的保护
    
            if [ -f "test.py" ]; then
    
              if python test.py; then
    
                echo "$problem 测试通过 ✅"
                ((total_score+=20))
              else
    
                echo "$problem 测试失败 ❌"
              fi
    
            else
    
              echo "::error::缺少测试文件 $problem/test.py"
              ((total_score+=0))
            fi
    
            cd ..
            ((tested_count++))
          else
    
            echo "$problem 目录未找到 ❗"
          fi
    
          echo ""
        done
    
        echo "已测试题目数: $tested_count/5"
        echo "总得分: $total_score/100"
        # 移除 exit 1 强制失败逻辑
    
        echo "评分已完成（状态码始终成功）"
