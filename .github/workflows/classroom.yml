name: Manual Grading

on: 
  workflow_dispatch:  # 手动触发

jobs:
  autograde:
    runs-on: ubuntu-latest

    
    steps:
    - name: Checkout Code

      uses: actions/checkout@v4

    - name: Set up Python

      uses: actions/setup-python@v4

      with:
        python-version: '3.10'

    # 新增依赖安装步骤 ▼▼▼

    - name: Install Dependencies

      run: |
        if [ -f "requirements.txt" ]; then

          echo "正在安装全局依赖..."
          pip install -r requirements.txt

        else

          echo "::warning::根目录未找到requirements.txt文件"
        fi

    - name: Run All Tests

      run: |
        total_score=0

        tested_count=0

        for problem in Problem1 Problem2 Problem3 Problem4 Problem5; do

          echo "▄▄▄▄▄▄▄ Testing $problem ▄▄▄▄▄▄▄"
          
          if [ -d "$problem" ]; then

            cd $problem

            # 现在测试环境已包含全局依赖

            if python test.py; then

              echo "$problem 测试通过 ✅"
              ((total_score+=20))
            else

              echo "$problem 测试失败 ❌"
            fi

            cd ..
            ((tested_count++))
          else

            echo "$problem 目录未找到 ❗"
          fi

          echo ""
        done

        echo "已测试题目数: $tested_count/5"
        echo "总得分: $total_score/100"
        if [ $tested_count -lt 5 ]; then

          echo "::warning::有未提交的题目目录（缺省数：$((5 - tested_count))）"
        fi

        if [ $total_score -lt 100 ]; then

          exit 1

        fi
