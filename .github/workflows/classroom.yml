name: Manual Grading

on: 
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘

jobs:
  autograde:
    runs-on: ubuntu-latest

    
    steps:
    - name: Checkout Code

      uses: actions/checkout@v4

    - name: Set up Python

      uses: actions/setup-python@v4

      with:
        python-version: '3.10'

    # æ–°å¢ä¾èµ–å®‰è£…æ­¥éª¤ â–¼â–¼â–¼

    - name: Install Dependencies

      run: |
        if [ -f "requirements.txt" ]; then

          echo "æ­£åœ¨å®‰è£…å…¨å±€ä¾èµ–..."
          pip install -r requirements.txt

        else

          echo "::warning::æ ¹ç›®å½•æœªæ‰¾åˆ°requirements.txtæ–‡ä»¶"
        fi

    - name: Run All Tests

      run: |
        total_score=0
    
        tested_count=0
    
        has_errors=0  # æ–°å¢é”™è¯¯çŠ¶æ€æ ‡å¿—
    
        for problem in Problem1 Problem2 Problem3 Problem4 Problem5; do
    
          echo "â–„â–„â–„â–„â–„â–„â–„ Testing $problem â–„â–„â–„â–„â–„â–„â–„"
          
          if [ -d "$problem" ]; then
    
            cd $problem || { echo "::error::è¿›å…¥$problemç›®å½•å¤±è´¥"; has_errors=1; continue; }
            
            if [ -f "test.py" ]; then
    
              # ä½¿ç”¨set +eé˜²æ­¢æµ‹è¯•å¤±è´¥ä¸­æ–­æµç¨‹
    
              set +e
    
              python test.py
    
              test_exit=$?
              set -e
    
              
              if [ $test_exit -eq 0 ]; then
    
                echo "$problem æµ‹è¯•é€šè¿‡ âœ…"
                ((total_score+=20))
              else
    
                echo "$problem æµ‹è¯•å¤±è´¥ âŒ"
                has_errors=1  # æ ‡è®°æœ‰é”™è¯¯
    
              fi
    
            else
    
              echo "::error::ç¼ºå°‘æµ‹è¯•æ–‡ä»¶ $problem/test.py"
              has_errors=1
    
            fi
    
            
            cd ..
            ((tested_count++))
          else
    
            echo "::warning::$problem ç›®å½•æœªæ‰¾åˆ°"
          fi
    
          echo ""
        done
    
        echo "å·²æµ‹è¯•é¢˜ç›®æ•°: $tested_count/5"
        echo "æ€»å¾—åˆ†: $total_score/100"
        
        # æ ¹æ®é”™è¯¯çŠ¶æ€å†³å®šæœ€ç»ˆé€€å‡ºç 
    
        if [ $has_errors -eq 1 ]; then
    
          echo "::warning::å­˜åœ¨æœªé€šè¿‡çš„æµ‹è¯•æˆ–é”™è¯¯"
          exit 0  # å³ä½¿æœ‰é”™è¯¯ä¹Ÿè¿”å›æˆåŠŸçŠ¶æ€
    
        else
    
          echo "æ‰€æœ‰æµ‹è¯•å®Œç¾é€šè¿‡ ğŸ‰"
          exit 0
    
        fi
            echo "æ€»å¾—åˆ†: $total_score/100"
            # ç§»é™¤ exit 1 å¼ºåˆ¶å¤±è´¥é€»è¾‘
        
            echo "è¯„åˆ†å·²å®Œæˆï¼ˆçŠ¶æ€ç å§‹ç»ˆæˆåŠŸï¼‰"
